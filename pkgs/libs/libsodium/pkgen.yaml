packages:
  libsodium:
    dependencies:
    - musl
  libsodium-dev:
    dependencies:
    - musl-dev
version: 1.0.13
sources:
  - https://download.libsodium.org/libsodium/releases/libsodium-{{.Version}}.tar.gz
builddependencies:
  - gcc
  - libc-dev
script:
- |
  {{extract "libsodium" "gz"}}
  (cd libsodium && ./configure CFLAGS="-Os" --build={{confarch}}-unknown-linux-gnu --prefix=$(shell pwd)/out/libsodium/usr)
  $(MAKE) -C libsodium
  $(MAKE) -C libsodium check
  $(MAKE) -C libsodium install
  mkdir out/libsodium-dev/usr
  mv out/libsodium/usr/include out/libsodium-dev/usr/include
  rm out/libsodium/usr/lib/libsodium.la
  rm out/libsodium/usr/lib/libsodium.a
  rm -r out/libsodium/usr/lib/pkgconfig
  strip out/libsodium/usr/lib/*
