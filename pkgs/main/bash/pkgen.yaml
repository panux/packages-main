packages:
  bash:
    dependencies:
    - musl
    - ncurses
    - readline
    - libintl
  bash-doc:
  bash-headers:
  bash-locale:
    dependencies:
    - bash
version: 4.4.19
builddependencies:
- gcc
- musl-dev
- ncurses
- ncurses-headers
- readline-dev
- gettext-dev
- make
sources:
- https://ftp.gnu.org/gnu/bash/bash-{{.Version}}.tar.gz
- file://./oninstall.sh
builder: panux
script:
- |
  {{extract "bash" "gz"}}
  (cd bash && ./configure --without-bash-malloc --prefix=/usr)
  $(MAKE) -C bash
  $(MAKE) -C bash DESTDIR=$(shell pwd)/out/bash install
  {{pkmv "usr/include" "bash" "bash-headers"}}
  {{pkmv "usr/share/locale" "bash" "bash-locale"}}
  {{pkmv "usr/share" "bash" "bash-doc"}}
  rm out/bash/usr/lib/bash/Makefile.inc
  mkdir -p out/bash/etc/lpkg.d/alt.d/sh
  ln -s /usr/bin/bash out/bash/etc/lpkg.d/alt.d/sh/00_bash.provider
  echo /usr/bin/sh > out/bash/etc/lpkg.d/alt.d/sh/.target
  mv src/oninstall.sh out/bash/.oninstall
  chmod 700 out/bash/.oninstall
