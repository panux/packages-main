packages:
  musl:
  musl-a:
  musl-headers:
  musl-dev:
    dependencies:
    - musl-headers
    - musl-a
    - musl
version: v1.1.16
builddependencies:
  - gcc
sources:
  - git://git.musl-libc.org/musl?checkout={{.Version}}&proto=git
script:
  - |
    (cd src/musl && ./configure)
    $(MAKE) -C src/musl
    $(MAKE) -C src/musl DESTDIR=$(shell pwd)/out/musl install-libs
    $(MAKE) -C src/musl DESTDIR=$(shell pwd)/out/musl-headers install-headers
    mkdir -p out/musl/usr/lib out/musl/usr/bin
    {{pkmv "usr/local/musl/lib/*.a" "musl" "musl-a"}}
    rm -r out/musl/lib
    (cd out/musl && ln -s /usr/local/musl/lib/libc.so usr/lib/ld-musl-$(if $(filter x86,$(ARCH)),i386,$(ARCH)).so.1)
    (cd out/musl && ln -s /usr/local/musl/lib/libc.so usr/bin/ldd)
