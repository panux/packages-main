packages:
  efibootmgr:
    dependencies:
    - efivar
version: 14
sources:
- https://github.com/rhboot/efibootmgr/archive/{{.Version}}.tar.gz
builddependencies:
- popt-dev
- linux-headers
- zlib-dev
- gettext-dev
- gettext-static
- pkgconfig
- binutils
oneshell: true
data:
  deps:
    - efivar-include.tar.gz
    - efivar.tar.gz
    - libefiboot.tar.gz
    - libefivar.tar.gz
script:
- |
  {{- range $i, $v := .Data.deps}}
  wget https://repo.projectpanux.com/beta/$(ARCH)/pkgs/{{$v}} -O src/{{$v}}
  {{- end}}
  for i in src/*.tar.gz; do tar -xf $$i -C /; echo $$i; done
  tar -xf src/{{.Version}}.tar.gz
  mv efibootmgr-{{.Version}} efibootmgr
  sed -i -e s/-Werror// Make.defaults
  $(MAKE) -C efibootmgr EFIDIR=/boot/efi LDLIBS="-lefivar -lefiboot -lintl -lpopt"
  $(MAKE) -C efibootmgr libdir="/usr/lib" EFIDIR=/boot/efi DESTDIR=$(shell pwd)/out/efibootmgr install
  mv out/efibootmgr/usr/sbin out/efibootmgr/usr/bin
