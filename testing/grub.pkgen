packages:
  grub:
   dependencies:
    - xz
  grub-doc:
  grub-bios:
version: 2.02
builddependencies:
- automake
- autoconf
- gettext-dev
- gcc
- libc-dev
- ncurses-dev
- bison
- gettext-dev
- flex
- help2man
- musl-dev
- device-mapper-libs
- python
- librsync-dev
- fuse-dev
- device-mapper
- device-mapper-libs
- xz-dev
- freetype-dev
- linux-headers
- binutils
sources:
- https://ftp.gnu.org/gnu/grub/grub-{{.Version}}.tar.gz
script:
- tar -xf src/grub-{{.Version}}.tar.gz
- mv grub-{{.Version}} grub
- mkdir objdir
- (cd grub && ./autogen.sh)
- (cd objdir && ../grub/configure --build={{.Arch}}-pc-linux-gnu --prefix=/usr --sysconfdir=/etc --mandir=/usr/share/man --localstatedir=/var --disable-nls --disable-werror --with-platform=efi --disable-efiemu)
- (cd objdir && make)
- $(MAKE) -C objdir DESTDIR=$(shell pwd)/out/grub install
- mkdir -p out/grub-doc/usr/share
- mv out/grub/usr/share/info out/grub-doc/usr/share
- mkdir -p out/grub-bios/usr/lib
- mv out/grub/usr/lib/grub out/grub-bios/usr/lib

